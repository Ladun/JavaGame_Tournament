package com.ladun.game.Scene;

import com.ladun.engine.GameContainer;
import com.ladun.engine.Renderer;
import com.ladun.game.GameManager;
import com.ladun.game.objects.UI.Button;

public class MainMenuScene extends AbstractScene{

	private Button testButton;
	
	
	private boolean loading;
	private float loadingAngle;
	
	@Override
	public boolean init(GameManager gm, boolean active) {
		// TODO Auto-generated method stub
		this.active = active;
		this.name = "MainMenu";
		
		testButton = new Button(300, 300, 100,100,0xffad3867);
		objects.add(testButton);
		
		return true;
	}

	@Override
	public void update(GameContainer gc, GameManager gm, float dt) {
		// TODO Auto-generated method stub
		for(int i = 0; i < objects.size();i++) {
			if(objects.get(i).isActive())
				objects.get(i).update(gc, gm, dt);
		}
		
		if(testButton.isReleased())
		{
			loading = true;
			new Thread(new Runnable() {
				double stTime = System.currentTimeMillis();
				

				@Override
				public void run() {
					
					gm.getClient().connect();
					
					double nowTime = 0;
				
					while(!gm.getClient().isServerRespond()) {
						nowTime = (System.currentTimeMillis() - stTime) / 1000; 
						if(nowTime >= 5) {
							break;
						}
					}
					if(nowTime>= 5) {
						//TODO 서버가 닫혀있음
						System.out.println("Server is Closed");
					}
					else {
						gm.changeScene("InGame");
					}
					loading = false;
				}
				
			},"Connecting-Thread").start();;
		}
	}

	@Override
	public void render(GameContainer gc, Renderer r) {
		// TODO Auto-generated method stub

		for(int i = 0; i < objects.size();i++) {
			if(objects.get(i).isActive())
				objects.get(i).render(gc, r);
		}
		
		if(loading) {
			//TODO 로딩 이미지 띄우기
		}
	}

	//-------------------------------------------------------------------------------
	private void ConnectToServer() {
		
	}
	
	//-------------------------------------------------------------------------------
	@Override
	public int getLevelW() {
		// TODO Auto-generated method stub
		return 0;
	}

	@Override
	public int getLevelH() {
		// TODO Auto-generated method stub
		return 0;
	}

}
