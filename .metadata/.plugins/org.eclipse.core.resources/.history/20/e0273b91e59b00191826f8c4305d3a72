package com.ladun.game.components;

import com.ladun.engine.GameContainer;
import com.ladun.engine.Renderer;
import com.ladun.game.GameManager;
import com.ladun.game.objects.GameObject;

public class NetworkTransform extends Component{

	private final static float PACKET_SEND_TIME = 1/6f; 
	
	private float srcX, srcY, srcZ;
	private float srcAngle;
	private float dstX, dstY ,dstZ;
	private float dstAngle;
	
	private float time;
	
	private StringBuilder sb = new StringBuilder();
	
	public NetworkTransform(GameObject parent)
	{
		this.parent = parent;
		this.tag = "netTransform";		
	}
	
	@Override
	public void update(GameContainer gc, GameManager gm, float dt) {
		// TODO Auto-generated method stub
		time += dt;
		
		if(time > PACKET_SEND_TIME)
		{
			time = 0;
			srcX = parent.getPosX();
			srcY = parent.getPosY();
			srcZ = parent.getPosZ();
			srcAngle = parent.getAngle();
			sb.setLength(0);
			sb.append(srcX);
			sb.append(",");
			sb.append(srcY);
			sb.append(",");
			sb.append(srcZ);
			sb.append(",");
			sb.append(srcAngle);
			sb.append(",");
			gm.getClient().sendValue((sb.toString()).getBytes());
		}
		
		parent.setPosX(lerp(srcX,dstX,time / PACKET_SEND_TIME));
		parent.setPosY(lerp(srcY,dstY,time / PACKET_SEND_TIME));
		parent.setPosZ(lerp(srcZ,dstZ,time / PACKET_SEND_TIME));
		parent.setAngle(lerp(srcAngle,dstAngle,time / PACKET_SEND_TIME));		
		
	}

	@Override
	public void render(GameContainer gc, Renderer r) {
		// TODO Auto-generated method stub
		
	}

	public float lerp(float src, float dst, float percent) {
		return dst + (dst - src) * percent;
	}
}
